{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "68d177c8_c56a1362",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 31
      },
      "lineNbr": 0,
      "author": {
        "id": 1002229
      },
      "writtenOn": "2025-09-23T05:59:19Z",
      "side": 1,
      "message": "Hi @patrick@stwcx.xyz,\n\nCould you please kindly help review this change and proceed with merging if there are no further concerns? Thank you very much!\n\n### [Update Notice - Patch 31] \nI have uploaded a new patch (Patch 31) that includes additional code changes to address an issue we discovered during testing. For easier review, I\u0027m providing the update here.\n\n### [Additional Issue Found \u0026 Fixed in Patch 31] \nOn multi-platform systems, psusensor sporadically asserted low-voltage thresholds during AC off, causing false alerts. This issue occurs due to the lack of ordering between the PropertiesChanged signal that updates PowerState and the periodic sensor timer callback. The timer could read sensor data before the state cache was updated. As a result, readingStateGood() still allowed readings, and thresholds could assert briefly during expected power loss.\n\n### [Additional Solution/Design in Patch 31]\n- Listen to the RequestedPowerTransition property and gate readings earlier when the value is Transition.Off.\n- Add the helper function isChassisReqTransOff(slotId) to query the requested transition; if it is Transition.Off, skip psusensor readings.\n[Summary] This patch now contains:\n\n### [Test Log]\nThere are no unexpect psusensor VOLT_V event was observed in the SEL during AC off\n```\n \"2\": {\n    \"additional_data\": {},\n    \"event_id\": \"\",\n    \"message\": \"Execute chassis1 AC power off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:14:54.115000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:14:54.115000000Z\"\n  },\n  \"3\": {\n    \"additional_data\": {},\n    \"event_id\": \"\",\n    \"message\": \"Execute chassis2 AC power off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:14:54.508000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:14:54.508000000Z\"\n  },\n  \"4\": {\n    \"additional_data\": {},\n    \"event_id\": \"\",\n    \"message\": \"Execute chassis4 AC power off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:14:55.024000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:14:55.024000000Z\"\n  },\n  \"5\": {\n    \"additional_data\": {},\n    \"event_id\": \"\",\n    \"message\": \"Execute chassis3 AC power off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:14:55.540000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:14:55.540000000Z\"\n  },\n  \"6\": {\n    \"additional_data\": {},\n    \"event_id\": \"\",\n    \"message\": \"Execute chassis5 AC power off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:14:56.487000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:14:56.487000000Z\"\n  },\n  \"7\": {\n    \"additional_data\": {},\n    \"event_id\": \"\",\n    \"message\": \"Execute chassis6 AC power off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:14:57.150000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:14:57.150000000Z\"\n  },\n  \"8\": {\n    \"additional_data\": {},\n    \"event_id\": \"\",\n    \"message\": \"Execute chassis7 AC power off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:14:58.003000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:14:58.003000000Z\"\n  },\n  \"9\": {\n    \"additional_data\": {},\n    \"event_id\": \"\",\n    \"message\": \"Execute chassis8 AC power off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:14:58.969000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:14:58.969000000Z\"\n  },\n  \"10\": {\n    \"additional_data\": {\n      \"HOST_PATH\": \"/xyz/openbmc_project/state/host6\"\n    },\n    \"event_id\": \"\",\n    \"message\": \"Host6 state is off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:15:06.027000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:15:06.027000000Z\"\n  },\n  \"11\": {\n    \"additional_data\": {\n      \"HOST_PATH\": \"/xyz/openbmc_project/state/host5\"\n    },\n    \"event_id\": \"\",\n    \"message\": \"Host5 state is off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:15:07.423000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:15:07.423000000Z\"\n  },\n  \"12\": {\n    \"additional_data\": {\n      \"HOST_PATH\": \"/xyz/openbmc_project/state/host8\"\n    },\n    \"event_id\": \"\",\n    \"message\": \"Host8 state is off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:15:09.833000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:15:09.833000000Z\"\n  },\n  \"13\": {\n    \"additional_data\": {\n      \"HOST_PATH\": \"/xyz/openbmc_project/state/host4\"\n    },\n    \"event_id\": \"\",\n    \"message\": \"Host4 state is off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:15:10.488000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:15:10.488000000Z\"\n  },\n  \"14\": {\n    \"additional_data\": {\n      \"HOST_PATH\": \"/xyz/openbmc_project/state/host2\"\n    },\n    \"event_id\": \"\",\n    \"message\": \"Host2 state is off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:15:10.947000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:15:10.947000000Z\"\n  },\n  \"15\": {\n    \"additional_data\": {\n      \"HOST_PATH\": \"/xyz/openbmc_project/state/host3\"\n    },\n    \"event_id\": \"\",\n    \"message\": \"Host3 state is off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:15:12.707000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:15:12.707000000Z\"\n  },\n  \"16\": {\n    \"additional_data\": {\n      \"HOST_PATH\": \"/xyz/openbmc_project/state/host7\"\n    },\n    \"event_id\": \"\",\n    \"message\": \"Host7 state is off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:15:12.936000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:15:12.936000000Z\"\n  },\n  \"17\": {\n    \"additional_data\": {\n      \"HOST_PATH\": \"/xyz/openbmc_project/state/host1\"\n    },\n    \"event_id\": \"\",\n    \"message\": \"Host1 state is off\",\n    \"resolution\": \"\",\n    \"resolved\": false,\n    \"severity\": \"xyz.openbmc_project.Logging.Entry.Level.Informational\",\n    \"timestamp\": \"2025-08-22T03:15:13.402000000Z\",\n    \"updated_timestamp\": \"2025-08-22T03:15:13.402000000Z\"\n  }\n}\n```",
      "revId": "5ff91348bb60f9a63a56ca1d484ee233680eec60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}
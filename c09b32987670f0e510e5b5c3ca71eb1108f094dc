{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "fb08b400_8bc33fa9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-10-21T17:53:23Z",
      "side": 1,
      "message": "net in support of this, would just like to see the reactor abstraction limited to only reactors.",
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "afb2ea10_958596f3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-21T18:30:24Z",
      "side": 1,
      "message": "Thanks again for the feedback üëç",
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "965bf07b_513465a6",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 26,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-10-21T17:53:23Z",
      "side": 1,
      "message": "Same as below, lets not re-invent an API that already exists in a sensor-specific context.",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 26,
        "endChar": 6
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6d222f39_5a6eb7e8",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 26,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-21T18:30:24Z",
      "side": 1,
      "message": "I feel like you are missing the point of my efforts on common code.\n\nIf we make requesting the sensor part of common code, at some point we could abstract that so an individual sensor implementation does not have to call this at all.\n\nI have not seen any sensor reactor in this repo which does not request a bus name so i do not see the point of duplicating this call to each sensor reactor.",
      "parentUuid": "965bf07b_513465a6",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 26,
        "endChar": 6
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c1b331a_af54c1ee",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 26,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-11-10T15:37:05Z",
      "side": 1,
      "message": "\u003e I feel like you are missing the point of my efforts on common code.\n\nThis is probably true.\n\n\u003e \n\u003e If we make requesting the sensor part of common code, at some point we could abstract that so an individual sensor implementation does not have to call this at all.\n\nRequesting the name isn\u0027t unique to a sensor though. If we\u0027re going for abstraction and reuse, it should go in the common dbus class (where it already is).  It\u0027s quite possible I\u0027m not seeing the advantage here from code.  Is there another refactor you\u0027re considering that would make this more clear?\n\n\u003e \n\u003e I have not seen any sensor reactor in this repo which does not request a bus name so i do not see the point of duplicating this call to each sensor reactor.\n\nThe reason to \"duplicate\" is requesting the name is actually an indication that init is complete, and all of dbus is populated.  Different applications find that at different times in their lifecycle, so it\u0027s kept separate.",
      "parentUuid": "6d222f39_5a6eb7e8",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 26,
        "endChar": 6
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e2e7ef9_7b83a5d9",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 26,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-11-10T18:36:49Z",
      "side": 1,
      "message": "\u003e Requesting the name isn\u0027t unique to a sensor though. If we\u0027re going for abstraction and reuse, it should go in the common dbus class (where it already is). \n\nAbstractions without concrete examples often fall on deaf ears.\nIf we manage to establish a useful base class for what a `Reactor` is, maybe that can go some other repo long-term for re-use.\n\nThe point of this patch is broader than just requesting a name. It is for enabling the abstraction for Reactor code.\n\nIn reactors, there is an initialization phase, there is requesting a bus name.\nWe have various DBus matches, and configuration to deal with.\n\nThat\u0027s something each sensor has to deal with, and unlikely to change a lot in the near term.\n\n\u003e It\u0027s quite possible I\u0027m not seeing the advantage here from code. Is there another refactor you\u0027re considering that would make this more clear?\n\nIf you want to do integration testing on a common code, you can make an example sensor which implements the interfaces expected by the common code.\n\nNow the test coverage on the example sensor is *useless* since it is just a stub.\n\nBut it enables test coverage of the common code.\n\nIf we now maximize the amount of common code without hardware dependency ....\nand minimize the amount of hardware specific code ...\n\nthen we can maximize the effective test coverage of our unit tests.\n\n\u003e The reason to \"duplicate\" is requesting the name is actually an indication that init is complete, and all of dbus is populated. Different applications find that at different times in their lifecycle, so it\u0027s kept separate.\n\nThat\u0027s a tradeoff between framework/library approach to common code.\n\nIf you approach common code as a framework, the common code calls into the sensor specific code.\n\nIf you approach common code as a library, the sensor specific code calls into the library.\n\nWhen taking external dependencies, i usually prefer the library approach, since often no single dependency can assume role of being the framework in a complicated application.\n\nBut IMO if we can write both the framework (common code) and it\u0027s users (same repository), the \u0027framework\u0027 approach (common code calling into sensor specific code) is better,\n\nsince we often only have to get things right in a single source location.",
      "parentUuid": "6c1b331a_af54c1ee",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 26,
        "endChar": 6
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f5d5688a_67221d2b",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 41,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-10-21T17:53:23Z",
      "side": 1,
      "message": "We shouldn\u0027t reinvent asio::post in a different namespace.",
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f7ec0743_3750f1b3",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 41,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-21T18:30:24Z",
      "side": 1,
      "message": "The point here is to avoid having to pass `io` into it.\n\nIMO this simplifies the API from the sensor perspective and makes the code more readable.",
      "parentUuid": "f5d5688a_67221d2b",
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "67cf895b_363e7d0d",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 41,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-11-10T15:37:05Z",
      "side": 1,
      "message": "Lets leave this open until we decide if we even need a common io object owned somewhere. (in the other thread).",
      "parentUuid": "f7ec0743_3750f1b3",
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "876fa8bb_edbe2f8c",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 44,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-10-21T17:53:23Z",
      "side": 1,
      "message": "Why protected here?",
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "de52f06c_ee1c9735",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 44,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-21T18:30:24Z",
      "side": 1,
      "message": "Testing. I make things protected so a class can inherit from it and still access the members.\n\nIf i were to make it private then it would not be easily possible.",
      "parentUuid": "876fa8bb_edbe2f8c",
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6bf50bd_6876e239",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 44,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-11-10T15:37:05Z",
      "side": 1,
      "message": "Would just making a getter be easier?",
      "parentUuid": "de52f06c_ee1c9735",
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1e84f75a_9f287df3",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 44,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-11-10T18:36:49Z",
      "side": 1,
      "message": "Made it private. I can always introduce a getter later on in a separate patch.",
      "parentUuid": "a6bf50bd_6876e239",
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "de0bbc4c_13cfa36e",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 52,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-10-21T17:53:23Z",
      "side": 1,
      "message": "Probably don\u0027t need to store this as a bool in the constructor.  Just make the \"setupManufacturingModeMatch\" method available on the class.",
      "range": {
        "startLine": 52,
        "startChar": 15,
        "endLine": 52,
        "endChar": 40
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8f73e396_87bf1d76",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 52,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-21T18:30:24Z",
      "side": 1,
      "message": "I am storing it here because for most reactors they call it just before `io.run()` function.\n\nIf we make it available to call then it may be called twice or at some different point in the code.\n\nAgain, i feel like this patch is hitting some misunderstanding. The point of common code is to provide all the control flows which are common between sensor applications.\n\nIt\u0027s simpler code for the sensor application to just pass a single bool in the constructor rather than call the function by itself.",
      "parentUuid": "de0bbc4c_13cfa36e",
      "range": {
        "startLine": 52,
        "startChar": 15,
        "endLine": 52,
        "endChar": 40
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e687253_07b29ace",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 52,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-11-10T18:36:49Z",
      "side": 1,
      "message": "Can you reconsider this one?\n\nI wrote another comment in this review which was talking about \u0027framework\u0027 vs. \u0027library\u0027 approach to common code and i believe it applies here.\n\nIn this example of `hasManufacturingModeMatch\u0027 we are configuring a common code, and there are **only 2 possibilities.**\n\nSo there is only 1 mistake a sensor writer can make in this example.\n\n(i am taking an abstract view here since i do not know the code details here as well as you do)\n\nIn contrast, if the sensor writer has to call this by themselves, they may fail to call it, call it in the wrong place, call it multiple times, ....\n\nSo with that approach there are more errors which can be made and also more different kinds of errors.",
      "parentUuid": "8f73e396_87bf1d76",
      "range": {
        "startLine": 52,
        "startChar": 15,
        "endLine": 52,
        "endChar": 40
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5a4afce5_31b72494",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 68,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-10-21T17:53:23Z",
      "side": 1,
      "message": "nit, line wrapping",
      "range": {
        "startLine": 67,
        "startChar": 0,
        "endLine": 68,
        "endChar": 53
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ad282a4c_0e2dafbb",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 68,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-11-10T18:36:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5a4afce5_31b72494",
      "range": {
        "startLine": 67,
        "startChar": 0,
        "endLine": 68,
        "endChar": 53
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5bcc7fc_a238b274",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 72,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-10-21T17:53:23Z",
      "side": 1,
      "message": "in terms of an API, this really isn\u0027t something we should expose out of a \"general\" class.  It leaks the implementation that we\u0027re using dbus, sdbusplus, and gives raw access to the message.",
      "range": {
        "startLine": 72,
        "startChar": 9,
        "endLine": 72,
        "endChar": 17
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2e6ab27c_e9f49288",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 72,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-21T18:30:24Z",
      "side": 1,
      "message": "I\u0027m aware the abstraction is suboptimal. But i would rather have a common abstraction which is suboptimal (and then refactor that)\n\nrather than each sensor application (and whoever maintains it) coming up with some \u0027clever\u0027 solution on their own, and then we get 5 flavors of the same problem.\n\n\nIf you bring the requirement to have a \u0027good\u0027 api to any common code, then we might as well abandon any attempt at creating such in the first place.\n\n\nIMO, basically you are saying that we cannot de-duplicate the code because it\u0027s a bad code.\n\nIf we want to de-duplicate this then we would have to fix it 5 times and then de-duplicate the result? That sounds like we are just making more work for ourselves.",
      "parentUuid": "b5bcc7fc_a238b274",
      "range": {
        "startLine": 72,
        "startChar": 9,
        "endLine": 72,
        "endChar": 17
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c9814f8d_098536c4",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 72,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-11-10T15:37:05Z",
      "side": 1,
      "message": "\u003e I\u0027m aware the abstraction is suboptimal. But i would rather have a common abstraction which is suboptimal (and then refactor that)\n\nI don\u0027t agree.  If you\u0027re going to expose the raw API, just expose the raw api, don\u0027t wrap it in something else.\n\n\u003e \n\u003e rather than each sensor application (and whoever maintains it) coming up with some \u0027clever\u0027 solution on their own, and then we get 5 flavors of the same problem.\n\u003e \n\u003e \n\u003e If you bring the requirement to have a \u0027good\u0027 api to any common code, then we might as well abandon any attempt at creating such in the first place.\n\nWe disagree here, and that\u0027s fine.  My position is that if we\u0027re going to have common code, it MUST be a good api, because it needs to survive refactoring/reworking without being able to test.  If code is duplicated, we can rely more on testing for it to be correct (because presumably you will have tested the changes you made).\n\n\u003e \n\u003e \n\u003e IMO, basically you are saying that we cannot de-duplicate the code because it\u0027s a bad code.\n\nKinda, yeah.  Said another way, I would rather bad code be isolated in each application so breakages are per sensor.\n\n\u003e \n\u003e If we want to de-duplicate this then we would have to fix it 5 times and then de-duplicate the result? That sounds like we are just making more work for ourselves.",
      "parentUuid": "2e6ab27c_e9f49288",
      "range": {
        "startLine": 72,
        "startChar": 9,
        "endLine": 72,
        "endChar": 17
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2b6cdc6f_874de9e0",
        "filename": "src/Reactor.hpp",
        "patchSetId": 4
      },
      "lineNbr": 72,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-11-10T18:36:49Z",
      "side": 1,
      "message": "\u003e My position is that if we\u0027re going to have common code, it MUST be a good api, because it needs to survive refactoring/reworking without being able to test.\n\nDoes it work if i make a comment declaring `eventHandler` as deprecated + stable member?\n\nThen there is no need for it to survive reworks because it will not be reworked.\n\n\nNot being able to change some common codes is a common issue in sw development.\n\nWe can simply make another common code and deprecate the old one. Then the old one will no longer be developed and sensor reactors can move to the new API as-needed on their own timeframe.\n\nThen you still only have 2 APIs instead of one for each sensor.\n\n\u003e Kinda, yeah. Said another way, I would rather bad code be isolated in each application so breakages are per sensor.\n\nIf we make the `eventHandler` deprecated then it will effectively work the same, right?\n\nSince you already confirmed it\u0027s a bad API we would not have a use-case for changing it anyways, not even in a single sensor.\n\nIMO it would make more sense to handle the properties changed use-case in a common code v2 and then migrate the sensor to common code v2.",
      "parentUuid": "c9814f8d_098536c4",
      "range": {
        "startLine": 72,
        "startChar": 9,
        "endLine": 72,
        "endChar": 17
      },
      "revId": "c09b32987670f0e510e5b5c3ca71eb1108f094dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}
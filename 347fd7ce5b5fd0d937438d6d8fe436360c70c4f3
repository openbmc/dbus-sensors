{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "d440efb6_3f09eebf",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-08-06T18:09:20Z",
      "side": 1,
      "message": "Considering entity-manager is generally doing the binding, that doesn\u0027t seem like it would be the case.  Is there more background here?",
      "range": {
        "startLine": 9,
        "startChar": 57,
        "endLine": 10,
        "endChar": 37
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "614ee073_8b7b24a9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2021-08-23T09:52:13Z",
      "side": 1,
      "message": "As my understanding, the entity-manager will probe the device base on the FRU info which it got from Fru EEPROM in that device. Our Altras don\u0027t have Fru only the chassis have Fru EEPROM.\n\nWhen Bmc boots up with the host is off, the Altra drivers were not bind, they are probed but no sensor paths are created.\nThe drivers only are binded when the Altra chip are already On which identify by the CurrentHostState. At this moment, the sensor paths are available. The AmperCPUSensor daemon has to rescan the sensors.",
      "parentUuid": "d440efb6_3f09eebf",
      "range": {
        "startLine": 9,
        "startChar": 57,
        "endLine": 10,
        "endChar": 37
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fb3ae800_1ec3a056",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2022-06-16T01:17:28Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "614ee073_8b7b24a9",
      "range": {
        "startLine": 9,
        "startChar": 57,
        "endLine": 10,
        "endChar": 37
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ed786f5c_d39ae740",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-08-06T18:09:20Z",
      "side": 1,
      "message": "This seems like a problem for dbus interfaces.  Unless there\u0027s runtime data needed to make the sensors (which I don\u0027t see in this daemons current form) we should be creating the interfaces at all times.",
      "range": {
        "startLine": 11,
        "startChar": 62,
        "endLine": 12,
        "endChar": 62
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e8386f3_0364f233",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2021-08-23T09:52:13Z",
      "side": 1,
      "message": "I don\u0027t see any problem with the dbus interface here, the sensors interfaces are not created because the sensor paths are not available.",
      "parentUuid": "ed786f5c_d39ae740",
      "range": {
        "startLine": 11,
        "startChar": 62,
        "endLine": 12,
        "endChar": 62
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9109bcf8_d36700da",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2022-06-16T01:17:28Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "0e8386f3_0364f233",
      "range": {
        "startLine": 11,
        "startChar": 62,
        "endLine": 12,
        "endChar": 62
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2d1a12ed_ad47386e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-08-06T18:09:20Z",
      "side": 1,
      "message": "This is one thing I\u0027m not quite following, given this is the ampere CPU daemon, don\u0027t we know all the paths upfront?  The scanning code looks like it was copied from PSU sensor, but wouldn\u0027t be needed in this case, where we know exactly what paths will exist at compile time.",
      "range": {
        "startLine": 14,
        "startChar": 26,
        "endLine": 15,
        "endChar": 53
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d23cf8cc_e26c97cb",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2021-08-23T09:52:13Z",
      "side": 1,
      "message": "We knew the path, but at the first scan when BMC boot up with the host is off, the path is not available because the Altra driver is not binded.\nOne more case, in 2P system, when the host boots up with only 1 CPU, the second CPU is failed to boot. Only one sensor path is created. In this case only one driver is binded. At the next boot, 2 CPU boot normally, then there are 2 Altra drivers, one for CPU1 and one for CPU2.",
      "parentUuid": "2d1a12ed_ad47386e",
      "range": {
        "startLine": 14,
        "startChar": 26,
        "endLine": 15,
        "endChar": 53
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f6cbbed3_7288932a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2022-06-16T01:17:28Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "d23cf8cc_e26c97cb",
      "range": {
        "startLine": 14,
        "startChar": 26,
        "endLine": 15,
        "endChar": 53
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "35a6cb08_0bc242a4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 1000559
      },
      "writtenOn": "2022-07-20T19:15:43Z",
      "side": 1,
      "message": "\u003e One more case, in 2P system, when the host boots up with only 1 CPU, the second CPU is failed to boot. Only one sensor path is created. In this case only one driver is binded. At the next boot, 2 CPU boot normally, then there are 2 Altra drivers, one for CPU1 and one for CPU2.\n\nWith one global flag, createdSensor, set to true of there is any sensor is created. Can there be race condition where CPU1 is booted but CPU2 is not yet, and only CPU1 sensors are created.",
      "parentUuid": "f6cbbed3_7288932a",
      "range": {
        "startLine": 14,
        "startChar": 26,
        "endLine": 15,
        "endChar": 53
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "80d664bf_006eae9e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2022-08-04T12:23:42Z",
      "side": 1,
      "message": "There are some changing in the design from last year. Currently, AmpereCPUSensor service only scans and creates the SoCs sensors one time after it starts.The variable createdSensors is true mean the host sensors is created, no need to scan them again.",
      "parentUuid": "35a6cb08_0bc242a4",
      "range": {
        "startLine": 14,
        "startChar": 26,
        "endLine": 15,
        "endChar": 53
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dd8454a7_70e56f7e",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 782,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-08-06T18:09:20Z",
      "side": 1,
      "message": "Please do an exact match on the full enum.",
      "range": {
        "startLine": 782,
        "startChar": 22,
        "endLine": 782,
        "endChar": 38
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "33b28eff_62eb5740",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 782,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2021-08-23T09:52:13Z",
      "side": 1,
      "message": "Yes, I\u0027m updating code.",
      "parentUuid": "dd8454a7_70e56f7e",
      "range": {
        "startLine": 782,
        "startChar": 22,
        "endLine": 782,
        "endChar": 38
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2fdbc7e6_d0c8fdc2",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 782,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2021-09-06T08:02:49Z",
      "side": 1,
      "message": "Updated code.",
      "parentUuid": "33b28eff_62eb5740",
      "range": {
        "startLine": 782,
        "startChar": 22,
        "endLine": 782,
        "endChar": 38
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c81a3b0c_6f479a85",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 782,
      "author": {
        "id": 1001166
      },
      "writtenOn": "2022-01-14T22:58:58Z",
      "side": 1,
      "message": "After an AC cycle, the host sensors objects were not created, but a BMC reboot will have the host sensors populated. However, when amperecpusensor is delayed by the filter timer, we see the cpu sensors getting populated.",
      "parentUuid": "2fdbc7e6_d0c8fdc2",
      "range": {
        "startLine": 782,
        "startChar": 22,
        "endLine": 782,
        "endChar": 38
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f89173b0_c1a1b1a9",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 782,
      "author": {
        "id": 1000940
      },
      "writtenOn": "2022-01-15T08:05:44Z",
      "side": 1,
      "message": "Hi Avenash,\nCan you give more information about filter timer?\nBelow is some information:\nWhen BMC is rebooted while the Host is ON, as the Altra Host is currently ON, the driver can be probed. But in the case of A/C, as the Altra Host is not ON, smpro-hwmon driver will probe fail and you need to manually bind the HWMON device. Refer to https://github.com/ampere-openbmc/openbmc/blob/ampere/meta-ampere/meta-jade/recipes-ampere/platform/mtjade-utils/ampere_driver_binder.sh.\nYou can find in our implementation, after S0_FW_BOOT_OK is asserted, we delay 5s before binding the driver to ensure all sensor devices are available. But it is from the Altra sensor, not dbus-sensor\u0027s AmpereCPU",
      "parentUuid": "c81a3b0c_6f479a85",
      "range": {
        "startLine": 782,
        "startChar": 22,
        "endLine": 782,
        "endChar": 38
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "26079d95_9ea5a94a",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 782,
      "author": {
        "id": 1001166
      },
      "writtenOn": "2022-01-19T21:26:36Z",
      "side": 1,
      "message": "Hi Thang,\nThe filterTimer I am referencing is from the comment #801 from patchset 3.",
      "parentUuid": "f89173b0_c1a1b1a9",
      "range": {
        "startLine": 782,
        "startChar": 22,
        "endLine": 782,
        "endChar": 38
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "547ad700_376d5da3",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 782,
      "author": {
        "id": 1001166
      },
      "writtenOn": "2022-02-09T17:00:38Z",
      "side": 1,
      "message": "The solution to this will have to be resolved externally and so the code is good to be merged from our side.",
      "parentUuid": "26079d95_9ea5a94a",
      "range": {
        "startLine": 782,
        "startChar": 22,
        "endLine": 782,
        "endChar": 38
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d2d366a9_ce9ea032",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 782,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2022-06-16T01:17:28Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "547ad700_376d5da3",
      "range": {
        "startLine": 782,
        "startChar": 22,
        "endLine": 782,
        "endChar": 38
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "457995a0_77275135",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 801,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-08-06T18:09:20Z",
      "side": 1,
      "message": "This block doesn\u0027t track for me.  We should not be rearming the filter timer, and shouldn\u0027t be re-calling createSensors, which will create sensors every time the host boots, instead of only the first time.\n\nI suspect this needs an abstraction to create the sensors at all times, but only read them when the host is on, like the other sensors in this space do.",
      "range": {
        "startLine": 790,
        "startChar": 0,
        "endLine": 801,
        "endChar": 15
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "32b53a5a_15405149",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 801,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2021-08-23T09:52:13Z",
      "side": 1,
      "message": "Because there are no sensor paths until the host is on and the CPU drivers are binded. So we need rescan the host sensors each the boot time of host.\nThe number of the CPU drivers can be difference between the boot time and the number of sensors in the driver can be different too. It is depend on the number of device is plugged in CPU peripheral interfaces.\n\nAbout the filter timer, I will check it.",
      "parentUuid": "457995a0_77275135",
      "range": {
        "startLine": 790,
        "startChar": 0,
        "endLine": 801,
        "endChar": 15
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3283bad8_3b85d1fb",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 801,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2021-09-06T08:02:49Z",
      "side": 1,
      "message": "Removed the block.",
      "parentUuid": "32b53a5a_15405149",
      "range": {
        "startLine": 790,
        "startChar": 0,
        "endLine": 801,
        "endChar": 15
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6abe7183_b753d279",
        "filename": "src/AmpereCPUMain.cpp",
        "patchSetId": 3
      },
      "lineNbr": 801,
      "author": {
        "id": 1000945
      },
      "writtenOn": "2022-06-16T01:17:28Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "3283bad8_3b85d1fb",
      "range": {
        "startLine": 790,
        "startChar": 0,
        "endLine": 801,
        "endChar": 15
      },
      "revId": "347fd7ce5b5fd0d937438d6d8fe436360c70c4f3",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}
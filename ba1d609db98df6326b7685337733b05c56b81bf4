{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "1bc2f1b2_7168897b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000733
      },
      "writtenOn": "2023-11-06T18:53:05Z",
      "side": 1,
      "message": "I\u0027d be curious to hear more on that...is there a bug we should be fixing there instead?",
      "range": {
        "startLine": 10,
        "startChar": 34,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "ba1d609db98df6326b7685337733b05c56b81bf4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "501be32c_0be64f33",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1001140
      },
      "writtenOn": "2023-11-06T19:07:30Z",
      "side": 1,
      "message": "Maybe? Is libgpiod even thread (context?) safe?\n\nI didn\u0027t look into it too much once I realized the issue was only occurring at system boot when there were a number of configuration changes each triggering a callback. I stole the timer idea here from Entity Manager, but then realized a lot of other dbus-sensor daemons have them as well. I think reducing the amount of work done for a quick succession of configuration changes is always going to be correct.",
      "parentUuid": "1bc2f1b2_7168897b",
      "range": {
        "startLine": 10,
        "startChar": 34,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "ba1d609db98df6326b7685337733b05c56b81bf4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "71f5b409_cce8e7a0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000733
      },
      "writtenOn": "2023-11-06T19:37:25Z",
      "side": 1,
      "message": "Hmm -- while I\u0027m not deeply familiar with libgpiod and its internals, my rough understanding is that it\u0027s a fairly thin wrapper that just issues ioctl syscalls and doesn\u0027t have much in the way of internal state to maintain, so it\u0027s not the first thing I\u0027d suspect of harboring race conditions.\n\nPerhaps relatedly, could you expand on the nature of the failures you\u0027ve seen?  (I\u0027m not sure exactly how to interpret \"sensors were failing\" absent some more detail.)",
      "parentUuid": "501be32c_0be64f33",
      "range": {
        "startLine": 10,
        "startChar": 34,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "ba1d609db98df6326b7685337733b05c56b81bf4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1fb5e618_2bde7731",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1001140
      },
      "writtenOn": "2023-11-06T19:44:32Z",
      "side": 1,
      "message": "Yup, on a fresh BMC boot we were no longer finding a GPIO Sensor being enumerated:\n\n~# busctl tree xyz.openbmc_project.IntrusionSensor\n└─ /xyz\n  └─ /xyz/openbmc_project\n    └─ /xyz/openbmc_project/Chassis\n    \nLooking at gpioinfo I wouldn\u0027t even see anything bound to the CHASSIS_INTRUSION GPIO pin. Manually restarting the intrusion sensor daemon would result in the intrusion sensor being found no problem. This was because the createSensorsFromConfig is run once, without any competing callbacks from configuration changes.\n\nReducing the number of callbacks to one at a time appears to resolve the problem.",
      "parentUuid": "71f5b409_cce8e7a0",
      "range": {
        "startLine": 10,
        "startChar": 34,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "ba1d609db98df6326b7685337733b05c56b81bf4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5f803834_76b5b5b1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2023-11-06T22:40:34Z",
      "side": 1,
      "message": "How does that get us to a race in libgpiod though? Could this not be a concurrency issue with manipulating some other data structure internal to the intrusion sensor?",
      "parentUuid": "1fb5e618_2bde7731",
      "range": {
        "startLine": 10,
        "startChar": 34,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "ba1d609db98df6326b7685337733b05c56b81bf4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2c722e73_157c1256",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1001140
      },
      "writtenOn": "2023-11-06T23:59:16Z",
      "side": 1,
      "message": "I have to admit I\u0027m not really sure, I may have jumped too quickly to a conclusion there. Something appears to be racing in the callback and this patch appears to fix that, though it might be more of a sweeping under the rug than fixing.\n\nStill, I think that having something like this is likely the correct approach, especially given that other sensor daemons take similar approaches.",
      "parentUuid": "5f803834_76b5b5b1",
      "range": {
        "startLine": 10,
        "startChar": 34,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "ba1d609db98df6326b7685337733b05c56b81bf4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "27e33afb_8e75dc3f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2023-11-07T02:14:50Z",
      "side": 1,
      "message": "Perhaps then it\u0027s worth dropping the argument about races in libgpiod and using the consistency argument instead?",
      "parentUuid": "2c722e73_157c1256",
      "range": {
        "startLine": 10,
        "startChar": 34,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "ba1d609db98df6326b7685337733b05c56b81bf4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f8f7d65e_fe7a7b2a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1001140
      },
      "writtenOn": "2024-01-03T20:46:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "27e33afb_8e75dc3f",
      "range": {
        "startLine": 10,
        "startChar": 34,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "ba1d609db98df6326b7685337733b05c56b81bf4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}
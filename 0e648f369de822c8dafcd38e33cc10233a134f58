{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "db79a2dc_91e58a8e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1002253
      },
      "writtenOn": "2025-12-15T09:54:35Z",
      "side": 1,
      "message": "Has this been tested with a BMC reboot? After applying this patch, I observed a large number of redundant log messages following a BMC reboot. When powerStateChanged is triggered, it calls deactivate(), which invokes markAvailable(false). This sets the `Available` property to false, and its set callback updates the sensor value to `NaN`, which in turn triggers this event. I believe this event should only be triggered when a sensor reports an invalid reading, not when the sensor is intentionally deactivated due to a power state change.",
      "revId": "0e648f369de822c8dafcd38e33cc10233a134f58",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9f1dbf3a_531b78fb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1002253
      },
      "writtenOn": "2025-12-16T02:47:40Z",
      "side": 1,
      "message": "Furthermore, I observed that shortly after BMC boot, the PSUSensor `eventHandler` [1] is triggered even after the sensors have already been created. When this occurs, the `eventHandler` calls `createSensors()` with `sensorsChanged`, which first destroys the existing sensors via `~PSUSensor()`.\n\nDuring destruction, `~PSUSensor()` invokes `PSUSensor::deactivate()`, setting the Available property to `false`. If the sensor was previously `Available \u003d\u003d true`, the Available property setter updates the sensor value to `NaN`. This update then triggers the “Sensor Invalid Reading” logging mechanism for `non-always sensors` (as described in this patch), resulting in redundant log messages after BMC boot.\n\n[1] https://github.com/openbmc/dbus-sensors/blob/6ef897399d8c2fb9f005b0c0d0ba3f9bd115965f/src/psu/PSUSensorMain.cpp#L1175",
      "parentUuid": "db79a2dc_91e58a8e",
      "revId": "0e648f369de822c8dafcd38e33cc10233a134f58",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9a10b48e_666bfa43",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1002528
      },
      "writtenOn": "2025-12-16T06:53:36Z",
      "side": 1,
      "message": "Hi, Kevin\nSorry for the late reply.\n\nIn patch set 6, I have added a check to check the power state from the entity-manager to report events. I believe this can accurately reflect the sensor event reporting.\n\nSince dbus-sensors deploys multiple types of sensor daemons, each with slightly different handling methods, it is necessary to individually inspect any unexpected event reporting issues.\n\nFrom the feedback from our testing team and yours, there are currently three types of sensors that report events during AC or reboot:\n\n1. Virtual sensor:\nThe event reporting has been removed.\nhttps://gerrit.openbmc.org/c/openbmc/phosphor-virtual-sensor/+/84151\n\n2. SmbpbiSensor:\nAfter analyzing the logs, the sensor events are triggered after the host is powered on, which matches the expected \"PowerState\" setting to \"on\". I think there may be issues with sensor readings after the power state changes to \"on\", and I am continuing to track this issue.\n\n3. HwmonSensor:\nI believe this issue is similar to the one you mentioned with the PSU sensor. The problem with this sensor event reporting occurs because after creating the hwmon through eventHandler, the sensor created was not removed from sensorsChanged, causing the next time the eventHandler calls createSensors, the sensor gets deactivated, and a new sensor is created for updating, which is an unnecessary behavior.\n\nTherefore, with this type of sensor, we only see the InvalidSensorReading event in the logs, without the SensorRestored event.\nI have committed a patch to fix this issue: https://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/85641\n\nAlso, I’d like to understand what actions trigger the PSU sensor event that you mentioned?\n\nIf you have any comments or better suggestions, feel free to share them for further discussion. Thank you.",
      "parentUuid": "9f1dbf3a_531b78fb",
      "revId": "0e648f369de822c8dafcd38e33cc10233a134f58",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "743267e9_2f815264",
        "filename": "src/sensor.hpp",
        "patchSetId": 6
      },
      "lineNbr": 282,
      "author": {
        "id": 1001758
      },
      "writtenOn": "2025-11-06T23:39:28Z",
      "side": 1,
      "message": "What is non-always?",
      "revId": "0e648f369de822c8dafcd38e33cc10233a134f58",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2f6a0fc4_77413d1c",
        "filename": "src/sensor.hpp",
        "patchSetId": 6
      },
      "lineNbr": 282,
      "author": {
        "id": 1002528
      },
      "writtenOn": "2025-11-07T01:41:49Z",
      "side": 1,
      "message": "Thanks for your reply.\n\u0027Non-always\u0027 refers to any power state other than \u0027Always\u0027 (such as \u0027On\u0027, \u0027ChassisOn\u0027, or \u0027BiosPost\u0027), [1][2].\n\n[1]\nhttps://github.com/openbmc/dbus-sensors/blob/b5e823f73897a8d47087d91f3f936dc07506a6e1/src/Utils.hpp#L66\n\n[2]\nhttps://github.com/openbmc/entity-manager/blob/c10d4b8ce8ab25866e843fe1dda7671fc8294cad/schemas/legacy.json#L1278",
      "parentUuid": "743267e9_2f815264",
      "revId": "0e648f369de822c8dafcd38e33cc10233a134f58",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "09297bac_4d97087b",
        "filename": "src/sensor.hpp",
        "patchSetId": 6
      },
      "lineNbr": 282,
      "author": {
        "id": 1002528
      },
      "writtenOn": "2025-11-28T02:26:11Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2f6a0fc4_77413d1c",
      "revId": "0e648f369de822c8dafcd38e33cc10233a134f58",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}